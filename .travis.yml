services:
  - docker

branches:
  only:
  - master

before_install:
 - docker-compose build
 - docker-compose run -T -e RAILS_ENV=test --rm --entrypoint="bundle exec rake db:create" education
 - rm -rf Gemfile # skip the ruby bundler install
 - rm -rf Gemfile.lock # to avoid clashing gem installs in our container
 # https://docs.travis-ci.com/user/languages/ruby/#default-build-script

script:
  - docker-compose run -T -e RAILS_ENV=test --rm --entrypoint="bundle exec rspec" education